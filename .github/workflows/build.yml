name: Build and Test C++ Project

on:
  push:
    branches:
      - try  # Adjust the branch as needed

jobs:
  build-and-test:
    runs-on: windows-latest


    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install Chocolatey
      run: |
        Set-ExecutionPolicy Bypass -Scope Process -Force; `
        [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; `
        iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

    - name: Install Visual Studio 2022 Build Tools
      run: |
        choco install visualstudio2022buildtools --params "'/IncludeRecommended /IncludeOptional /quiet'"

    - name: Install Qt and Tools
      run: |
        choco install qtcreator --version=4.15.0 -y
        choco install qt5-sdk --version=5.15.2 -y
        choco install qt-vs-tools -y

    - name: Add Qt to PATH
      run: |
        $qtPath = "C:\Qt\5.15.2\msvc2019_64\bin"
        [Environment]::SetEnvironmentVariable("Path", [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine) + ";$qtPath", [System.EnvironmentVariableTarget]::Machine)


